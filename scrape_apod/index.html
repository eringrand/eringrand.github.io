<!DOCTYPE html>
<html>
  <head>
    <!-- htmlwidgets dependencies --> 
    
    
    

    

    <title>Scraping APOD Descriptions – Erin Grand – Interested in data science and education</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Orginal Plan - Scrape from Archive
" />
    <meta property="og:description" content="Orginal Plan - Scrape from Archive
" />
    
    <meta name="author" content="Erin Grand" />

    
    <meta property="og:title" content="Scraping APOD Descriptions" />
    <meta property="twitter:title" content="Scraping APOD Descriptions" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Erin Grand - Interested in data science and education" href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="https://avatars.githubusercontent.com/u/6360871?v=3" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Erin Grand</a></h1>
            <p class="site-description">Interested in data science and education</p>
          </div>

          <nav>
            <a href="/">Blog</a>
            <a href="/about">About</a>
            <a href="/projects">Projects</a>
            <a href="/archive">Archive</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      

<article class="post">
<h1>Scraping APOD Descriptions</h1>





<p id="post-meta"></p>

  <div class="entry">
    <h2 id="orginal-plan---scrape-from-archive">Orginal Plan - Scrape from Archive</h2>

<p>A long while ago now, <a href="https://twitter.com/Nujcharee">Nujchare</a> tweeted about an awesome vis she did using <code>rvest</code> and PowerBi.</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Using rvest + purrr packages to scrap APOD. PowerBI viz it up real nice! <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> <a href="https://twitter.com/hashtag/powerbi?src=hash&amp;ref_src=twsrc%5Etfw">#powerbi</a>. My learning journal during <a href="https://twitter.com/hashtag/NASADatanauts?src=hash&amp;ref_src=twsrc%5Etfw">#NASADatanauts</a> year of awesomeness.  <a href="https://t.co/cnwttLPoIS">https://t.co/cnwttLPoIS</a> <a href="https://t.co/je511h99L9">pic.twitter.com/je511h99L9</a></p>&mdash; Nujcharee (เป็ด) (@Nujcharee) <a href="https://twitter.com/Nujcharee/status/939257591431036929?ref_src=twsrc%5Etfw">December 8, 2017</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>I complemented her work and she asked me to look over the code. I jumped at the chance, (1) because I don’t know a ton about scraping website data and wanted to see what she started, (2) I could help with the <code>dplyr</code> part of the code, and most imporantly (3) I love APOD!</p>

<p>I love APOD so much, that for most of my childhood my life goal was “get a picture published to APOD.” To make matters more exciting in 2009 <a href="https://apod.nasa.gov/apod/ap090917.html">this happened</a>.</p>

<p><img src="../images/apod_me.png" alt="" /></p>

<h2 id="getting-the-data">Getting the Data</h2>

<p>To start, we grab the information from the landing page of APOD’s archive and ignore any links that are not pictures of the day. (Luckily, these all start with “ap” so we can use <code>str_detect()</code> to find them.)</p>

<pre><code class="language-r">library(rvest)
library(tidyverse)
library(tidytext)

## scrape the landing page
apod &lt;- read_html("https://apod.nasa.gov/apod/archivepix.html")

## scrape all URLs
url &lt;- html_nodes(apod, "a") %&gt;% 
  map_chr(xml_attrs) %&gt;%
  tibble(url = .) %&gt;%
  filter(str_detect(url, "ap"), !str_detect(url, "/"))
</code></pre>

<p>Next, we have to go to each of the pages and scrape the underlying page data. There are A LOT of APODs, so this can take a long time. I’ve chosen to only look at the first 1000 images for now. (More on solving this at the end!)</p>

<pre><code class="language-r"># read html from url
my_read_html &lt;- function(url, ...) {
  xml2::read_html(url, ...)
}

data_raw &lt;- url[1:1000, ] %&gt;% # first 1000 links
  mutate(full_url = paste0("https://apod.nasa.gov/apod/", url)) %&gt;%
  mutate(page = map(full_url, my_read_html),
         pic = map_chr(page, ~html_node(.x, xpath = "//*/img") %&gt;% html_attr("src")),
         title = map_chr(page, ~html_nodes(.x, "title") %&gt;% html_text()),
         description = map_chr(page, ~html_nodes(.x, "p") %&gt;% html_text() %&gt;% .[str_detect(., "Ex")]) # descriptions start with "Explanation:"
         )
</code></pre>

<h2 id="data-cleaning">Data Cleaning</h2>

<p>With the raw data in hand, I move into more specific text cleaning. I want to start with some quick tidy text analysis of the descriptions, so I cant to clean that up first.</p>

<pre><code class="language-r">data &lt;- data_raw %&gt;% 
  mutate(description = str_replace_all(description, "\n", " "),
         description = str_replace_all(description, "Explanation:", ""),
         title = str_replace_all(title, "\n", " "),
         title = str_replace_all(title, "APOD:", ""),
         title = if_else(str_detect(title, "2017 November 22"), "2017 November 22 - Oumuamua Interstellar Asteroid", title)
         ) %&gt;%
  mutate_all(trimws) %&gt;%
  separate(title, into = c("date", "title"), sep = " - ")
</code></pre>

<p>Great, now we can a do a quick word count using tidytext tools.</p>

<h2 id="fun-stuff---word-count">Fun Stuff - word count</h2>

<pre><code class="language-r">keep_words &lt;- c("way") # I don't want "way" as in "Milky Way" to be filtered
my_stop_words &lt;- tibble(word = c("image")) %&gt;%
  mutate(lexicon = "PERSONAL") %&gt;%
  bind_rows(stop_words) %&gt;%
  filter(!word %in% keep_words)
  

data %&gt;%
  select(-date) %&gt;%
  distinct() %&gt;%
  unnest_tokens(word, description) %&gt;%
  anti_join(my_stop_words) %&gt;%
  count(word, sort = TRUE) %&gt;%
  top_n(10)
</code></pre>

<pre><code>## # A tibble: 10 x 2
##    word       n
##    &lt;chr&gt;  &lt;int&gt;
##  1 light   1088
##  2 star     725
##  3 stars    656
##  4 galaxy   636
##  5 nebula   627
##  6 moon     522
##  7 sun      497
##  8 earth    496
##  9 bright   461
## 10 sky      411
</code></pre>

<p>I love this because it clearly shows the types of objects that make up most of pretty Astronomy pictures, i.e stars, galaxies and nebulae. Very cool!</p>

<p>If I look at bi-grams is there any doubt that “Milky Way” will have a strong showing?</p>

<pre><code class="language-r">data %&gt;%
  select(-date) %&gt;%
  distinct() %&gt;%
  unnest_tokens(word, description, token = "ngrams", n = 2) %&gt;%
  select(title, word) %&gt;%
  separate(word, into = c("word1", "word2"), by = " ") %&gt;%
  unite(word, word1, word2, sep = " ") %&gt;%
  count(word, sort = TRUE) %&gt;%
  top_n(10)
</code></pre>

<pre><code>## # A tibble: 10 x 2
##    word                n
##    &lt;chr&gt;           &lt;int&gt;
##  1 milky way         315
##  2 planet earth      205
##  3 way galaxy        133
##  4 million light     118
##  5 solar system      114
##  6 space telescope   106
##  7 star forming      100
##  8 hubble space       88
##  9 spiral galaxy      88
## 10 star cluster       75
</code></pre>

<p>…and there it is, clearly winning over “Planet Earth” and “Solar System.”</p>

<p>As a person who studied star formation, I’m also proud of the strong showing of “star forming” in the bi-grams. Yay baby stars!</p>

<h2 id="but-wait-isnt-there-an-api">But wait… isn’t there an API?</h2>

<p>This is great and fun, but what I’d really love to look at the entire APOD archive, or pull a specific date. Luckily, NASA has a great <a href="https://github.com/nasa/apod-api">API</a> to do just that! The API is super easy to use and simple enough to write into some R functions. I decided the coolest thing to do with this API was create a package, and thus my new package - <a href="https://github.com/eringrand/astropic">astropic</a> was born (available on github)!</p>

<p>The goal of <a href="https://github.com/eringrand/astropic">astropic</a> is to connect R to the NASA APOD API. The APOD API supports one image at a time. In order to supply more than that, this package also includes creating time ranges (of less than 1000 days at a time) and some historical data in tibble format.</p>

<p>You can install the current version from GitHub to check it out</p>

<pre><code class="language-r"># install.packages("devtools")
devtools::install_github("eringrand/astropic")
</code></pre>

<p><a href="https://github.com/eringrand/astropic">Astropic</a> does not yet contain ANY tests and the documentation is very sparse. It is most definitely a work in progress - I’ll update more as I add more to it.</p>

<p>Next time on the blog, more about the package creation and cool things you can do with it. In the mean time, please feel free to send pull requests and let me know what you’d like from such a package.</p>


  </div>

  <div class="date">
    Written on April 21, 2018
  </div>

  
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">
    
	    var disqus_shortname = 'astroeringrand'; 

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:eringrand@gmail.com"><i class="svg-icon email"></i></a>


<a href="https://github.com/eringrand"><i class="svg-icon github"></i></a>
<a href="https://instagram.com/astroeringrand"><i class="svg-icon instagram"></i></a>
<a href="https://www.linkedin.com/in/eringrand"><i class="svg-icon linkedin"></i></a>

<a href="/feed.xml"><i class="svg-icon rss"></i></a>
<a href="https://www.twitter.com/astroeringrand"><i class="svg-icon twitter"></i></a>

<a href="https://youtube.com/channel/UCAMkBTcL3PAjgnETfWWKkCQ"><i class="svg-icon youtube"></i></a>

        </footer>
      </div>
    </div>

    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		
		ga('create', 'UA-59780775-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/scrape_apod/',
		  'title': 'Scraping APOD Descriptions'
		});
	</script>
	<!-- End Google Analytics -->


  </body>
</html>



